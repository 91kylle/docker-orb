description: >
  Sanity check to make sure you can build a Docker image. Check that
  $DOCKER_LOGIN and $DOCKER_PASSWORD environment variables are set, then
  run docker login to ensure that you can push the built image

parameters:
  registry:
    type: string
    default: docker.io
    description: Name of registry to use

steps:
  - run:
      name: Check environment variables
      command: |
        if [[ -z "${DOCKER_LOGIN}" ]]; then
          echo "DOCKER_LOGIN is not set, will not be able to push image."
          exit 1
        fi

        if [[ -z "${DOCKER_PASSWORD}" ]]; then
          echo "DOCKER_PASSWORD is not set, will not be able to push image."
          exit 1
        fi

  - run:
      name: Docker login
      command: |
        docker login -u "${DOCKER_LOGIN}" -p "${DOCKER_PASSWORD}" <<parameters.registry>>
